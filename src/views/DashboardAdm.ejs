<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/contentDashAdmin.css" />
  <link rel="stylesheet" href="/css/dash.css" />
  <link rel="stylesheet" href="/css/sideBar.css" />
  <link rel="stylesheet" href="/css/header.css" />
  <link rel="shortcut icon" href="/utilites/favicon.ico" type="image/x-icon" />
  <script type='text/javascript' src='https://www.gstatic.com/charts/loader.js'></script> 
  <link rel="stylesheet" href="/css/spinner.css">

  <title>Dashboard Admin</title>
</head>
<body> 
   <main class="content">
    <%- include("Header.ejs",{user: user}) %>
      <div class="slidebar">
        <div class="logo">
          <img src="/utilites/logo.png" alt="" />
        </div>
        <ul class="links-bar">
            <% if(user.office!== "Administrador") { %>  
                <li  class="selected-page"> 
                  <a href="/dashboard/index/">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-grid-1x2-fill" viewBox="0 0 16 16">
                        <path d="M0 1a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm9 0a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1h-5a1 1 0 0 1-1-1zm0 9a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1h-5a1 1 0 0 1-1-1z"/>
                      </svg> 
                      Dashboard
                  </a>
                </li> 
                <% }else { %>
                  <li class="selected-page"> 
                    <a href="/dashboardadm/index/"> 
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-grid-1x2-fill" viewBox="0 0 16 16">
                            <path d="M0 1a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1zm9 0a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1h-5a1 1 0 0 1-1-1zm0 9a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1h-5a1 1 0 0 1-1-1z"/>
                          </svg> 
                          Dashboard
                    </a>
                  </li> 
               <% } %>
          <% if(user.office ==="Administrador") { %>
            <li>
              <a href="/allUsers/index/">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-person-circle" viewBox="0 0 16 16">
                  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                  <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                </svg> 
                Usuários
              </a>
            </li>
            <% } %> 
          <li>
            <a href="/crm/index/"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black"
                class="bi bi-heart" viewBox="0 0 16 16">
                <path
                  d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15" />
              </svg> 
              CRM
            </a>
          </li>
          <li>
            <a href="/home/index/">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-people" viewBox="0 0 16 16">
                <path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
              </svg> 
              Leads
            </a>
          </li>
          <li>
            <a href="/product/index">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-box-seam" viewBox="0 0 16 16">
                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2zm3.564 1.426L5.596 5 8 5.961 14.154 3.5zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464z"/>
              </svg> 
              Produtos
            </a>
          </li> 
          <% if(user.office ==="Administrador") { %> 
            <li>
            <a href="/sales/index/">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-currency-dollar"
                viewBox="0 0 16 16">
                <path
                  d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73z" />
              </svg> 
              Vendas
            </a>
          </li>
          <% } %>
          <li id="sentings">
            <a href="/settings/index/">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-gear"
                viewBox="0 0 16 16">
                <path
                  d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0" />
                <path
                  d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115z" />
              </svg>  
              Configurações
            </a>
          </li>
          <li id="exit">
            <a href="/home/index/logout">
              <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="black" class="bi bi-unindent"
                viewBox="0 0 16 16">
                <path fill-rule="evenodd"
                  d="M13 8a.5.5 0 0 0-.5-.5H5.707l2.147-2.146a.5.5 0 1 0-.708-.708l-3 3a.5.5 0 0 0 0 .708l3 3a.5.5 0 0 0 .708-.708L5.707 8.5H12.5A.5.5 0 0 0 13 8" />
                <path fill-rule="evenodd" d="M3.5 4a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 1 0v-7a.5.5 0 0 0-.5-.5" />
              </svg> 
              Logout
            </a>
          </li>
        </ul>
      </div>
      <main class="dash">
        <div class="geral-view">
          <div class="total-leads">
            <div class="text-total-lead">
              <p class="total-lead-title">
              Receita Geral
              </p>
              <div class="button-view-all go-leads">
                <img src="/utilites/view-all-icon.svg" alt="">
              </div>
            </div>

            <h3 id="leads-count">
             
            </h3>
          </div> 
          

          <div class="total-view">
            <div class="text-total-view">
              <p class="total-view-p">
                Total de Produtos Cadastrados
              </p>
              <div class="button-view-all-type-2 go-leads">
                <img src="/utilites/view-all-icon.svg" alt="">
              </div>
            </div>
            <h3 id="today-count" class="count">
              <%=allProducts.length%>
            </h3>
          </div>  
          <div class="total-view">
            <div class="text-total-view">
              <p class="total-view-p">
                Total de Vendas
              </p>
              <div class="button-view-all-type-2 go-leads">
                <img src="/utilites/view-all-icon.svg" alt="">
              </div>
            </div>
            <h3 id="today-count" class="count">
              <%=allSalesFinish%>
            </h3>
          </div> 
          
          <div class="total-view">
            <div class="text-total-view">
              <p class="total-view-p">
                Leads Cadastradas
              </p>
              <div class="button-view-all-type-2 go-leads">
                <img src="/utilites/view-all-icon.svg" alt="">
              </div>
            </div>
            <h3 id="count-month" class="count">
              <%= leadsAll.length %>
            </h3>
          </div>

        </div>
        <section class="grafico-area">
          <div class="grafico-line">
            <canvas id="sallers"></canvas>
            <canvas id="sale_status"> </canvas> 
          </div>
          <div class="grafico-bar"> </canvas><canvas id="lead_status"> </canvas></div>
          <div class="grafico-more"><canvas id="donout"></canvas></div>
          <div class="grafico-polar"><canvas id="polar"></canvas></div>
        </section>
      </main>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>

    const leadsInDb = <%- JSON.stringify(leadsAll) %>; 
    const salesValues = <%-JSON.stringify(allSalesValues) %>
    const process =  <%- JSON.stringify(allProcess) %>; 
    const category = <%- JSON.stringify(categories)%>;  
    const users =  <%- JSON.stringify(allUsers)%>;    
    const sales = <%-JSON.stringify(allSales) %>; 
    const products = <%-JSON.stringify(allProducts)%>; 

    const userName = users.map(user=>user.nome); 
    const categoryName = category.map(categories=>categories.name); 
    const nameProcess = process.map(prcs => prcs.process);    
    const ProductsName = products.map(prod=> prod.name); 
    const SalesStatusFinish =  sales.filter(sale=> sale.status ==="Concluída");  
    const SalesStatusPending =  sales.filter(sale=> sale.status ==="Pendente"); 
    const SalesStatusCancel =  sales.filter(sale=> sale.status ==="Cancelada"); 
    const hotLead = leadsInDb.filter(lead=> lead.typeLead ==="Quente");  
    const chillLead = leadsInDb.filter(lead=> lead.typeLead ==="Fria");  
    
    let numberOfLeadWithUsers = []; 
    let numberOfSalesForCategory = []; 
    let numberOfSalesForProduct = [];
    let arraySalesForCategory =[]; 
    let arraySalesForProduct = [];
    let arrayUsers = [];   

    let numberOfLeadWithCategories = [];  
    let arrayCategories = []; 
    let numbeOfLeadWithProcess = []; 
    let arrayProcess = []     

    for(let i in ProductsName)  {
        arraySalesForProduct = sales.filter(sale=> sale.productOurService === ProductsName[i]); 
        numberOfSalesForProduct.push(arraySalesForProduct.length); 
    }
    for(let i in categoryName)  {
      arraySalesForCategory = SalesStatusFinish.filter(sale=> sale.productCategory === categoryName[i]); 
      numberOfSalesForCategory.push(arraySalesForCategory.length); 
    }

    //usser Register Contage  
    for(let i in userName)  {
      arrayUsers = SalesStatusFinish.filter(sale=> sale.saller === userName[i]); 
      numberOfLeadWithUsers.push(arrayUsers.length); 
    }
    //Category contage 
    for(let i in categoryName) {
      arrayCategories = leadsInDb.filter(lead=> lead.material === categoryName[i]); 
      numberOfLeadWithCategories.push(arrayCategories.length)
    } 
    //process contage 
    for (let j in nameProcess) {
      arrayProcess = leadsInDb.filter((lead) => (lead.process === nameProcess[j]))
      numbeOfLeadWithProcess.push(arrayProcess.length);
    }  
    //Chart Clients and Fornecer
    const ctx1 = document.getElementById("sale_status");
    new Chart(ctx1, {
      type: "doughnut",
      data: {
        labels: ["Finalizada","Pendente","Cancelada"],
        datasets: [
          {
            label: "Estatus das Vendas",
            data: [ SalesStatusFinish.length,  SalesStatusPending.length,SalesStatusCancel.length],
            borderWidth: 1,
            backgroundColor: [
              '#198754',
              "#FFC107",
              "#DC3545",

              
            ],
           
          },
        ],
      },
      
    });

    const ctx5 = document.getElementById("lead_status");
    new Chart(ctx5, {
      type: "pie",
      data: {
        labels: ["Lead Fria","Lead Quente"],
        datasets: [
          {
            label: "Tipo de Leads",
            data: [chillLead.length, hotLead.length ],
            borderWidth: 1,
            backgroundColor: [
            "#68F263",
            "#black",
             

              
            ],
            borderColor: '#5EE95C',
          },
        ],
      },
      
    });
    // Chart bar User Registration
    const ctx2 = document.getElementById("sallers");
    new Chart(ctx2, {
      type: "bar",
      data: {
        labels: userName,
        datasets: [
          {
            label: "Desempenho dos Vendedores",
            data: numberOfLeadWithUsers,
            borderWidth: 1,
            backgroundColor: [
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C'
            ],
            borderColor: '#5EE95C',
          },
        ],
      },
      options: {
        indexAxis: "x",
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      },
    });

    // Chart Process 
    const ctx3 = document.getElementById("donout");
    new Chart(ctx3, {
      type: "bar",
      data: {
        labels:categoryName,
        datasets: [
          {
            label: "Categorias Mais Vendidas",
            data: numberOfSalesForCategory,
            borderWidth: 1, 
            backgroundColor: [
            
          "#96D9A5",
          "#9FD996",
          "#F2F2F2",
          "#6A8466",
          "#0D0D0D",
          "#3C2E25",
          ],
            borderColor: '#5EE95C',
          },
        ],
      },
      options: {
        indexAxis: "y",
        scales: {
          y: {
            beginAtZero: true,
          },
        },
      },
    });
  //Chart Category  
  const ctx4 = document.getElementById("polar");
  new Chart(ctx4, {
  type: "bar",
  data: {
    labels:ProductsName ,
    datasets: [
      {
        label: "Produtos Mais Vendidos",
        data: numberOfSalesForProduct,
        backgroundColor: [
         '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
              '#5EE95C',
        ],
        borderColor: "black",
      },
    ],
  },
 
});  
let SaleValueFormated = salesValues.toLocaleString('pt-br',{style: 'currency', currency: 'BRL'});
 document.getElementById("leads-count").innerHTML = SaleValueFormated; 


  </script>

<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="/js/jQuery/code.jquery.com_jquery-3.7.1.js"></script> 
  <script src="/js/dash.js"></script>
  <script src="/js/Dashanimation.js"></script>
  <script src="/js/redirections.js"></script>
</body>

</html>